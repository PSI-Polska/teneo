<project name="Automated Testing for Teneo" default="all"  basedir="." >

	<!--properties file containing the plugin directory name including version number-->
	<property file="test.properties" />

	<!--properties file containing other test flags and options -->
	<property file="testing.properties" />

	<!--default directory where test-eclipse will be installed-->
	<property name="install" value="${basedir}/target" />

	<!--name that can be added to report name to identify which platform tests results come from-->
	<property name="platform" value="" />

	<!-- The root of the eclipse installation -->
	<property name="eclipse-home" value="${install}/eclipse" />

	<!-- The directory that will contain the xml and html results from the tests that are run -->
 	<property name="results" value="${basedir}/results" />

	<target name="init">
	</target>

	<target name="setup" if="clean" description="Reinstall the test Eclipse installation if specified by user">
	</target>

	<target name="runtests" depends="setup" description="Runs ant on the test.xml for a specified plugin.  Requires a property value setting for testPlugin only if test.properties is not available.  The property testPlugin represents a directory name made up of the plugin id and plugin version.  This directory must contain a valid test.xml.">
		<tstamp><format property="runtests-starttime" pattern="HH:mm:ss"/></tstamp>
		<echo message="Start: [${runtests-starttime}]"/>
		<ant antfile="${eclipse-home}/plugins/${testPlugin}/test.xml" dir="${eclipse-home}" />
		<copy file="${eclipse-home}/${report}.xml" tofile="${results}/xml/${report}_${platform}.xml" verbose="true"/>
		<tstamp><format property="runtests-endtime" pattern="HH:mm:ss"/></tstamp>
		<echo message="Done: [${runtests-endtime}]"/>
	</target>

	<target name="teneo" description="Runs the test.xml of the test plugins">
		<antcall target="runtests">
			<param name="testPlugin" value="${org.eclipse.emf.teneo.hibernate.test}" />
			<param name="report" value="org.eclipse.emf.teneo.hibernate.test" />
		</antcall>
<!--
		<antcall target="runtests">
			<param name="testPlugin" value="${org.eclipse.emf.teneo.jpox.generate.test}" />
			<param name="report" value="org.eclipse.emf.teneo.jpox.generate.test" />
		</antcall>

		<antcall target="runtests">
			<param name="testPlugin" value="${org.eclipse.emf.teneo.jpox.test}" />
			<param name="report" value="org.eclipse.emf.teneo.jpox.test" />
		</antcall>
-->
	</target>

	<target name="all">
		<antcall target="teneo" />
	</target>
</project>