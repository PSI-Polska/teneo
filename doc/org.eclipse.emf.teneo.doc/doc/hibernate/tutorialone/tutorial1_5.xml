<?xml version="1.0" encoding="UTF-8"?>
<!--
	Copyright (c) 2005, 2006 Springsite BV (The Netherlands) and others
	All rights reserved. This program and the accompanying materials
	are made available under the terms of the Eclipse Public License v1.0
	which accompanies this distribution, and is available at
	http://www.eclipse.org/legal/epl-v10.html
-->

<!--
	@author <a href="mtaal@elver.org">Martin Taal</a>
	@version $Revision: 1.2 $ $Date: 2006/09/13 10:42:35 $
-->

<!DOCTYPE document PUBLIC
	"-//APACHE//DTD Documentation V2.0//EN"
	"http://forrest.apache.org/dtd/document-v20.dtd">

<document> 
	<header> 
		<title>Step 5: Using Hibernate EMF Resources</title> 
	</header> 
	<body>
		<p>The EMF Resource concept is very different from a relational/querying approach. In this part of the 
			tutorial it is described how objects can be loaded, updated and saved using the 
			Hibernate EMF resource implementation.</p>
		<p>For more information on Hibernate EMF resource <a href="../hibernateresources.html">see</a>.</p>
		<section>
			<title>Create a resource</title>
			<p>An EMF resource is retrieved using a specific URL. 
			An example of a URL which retrieves a hibernate resource is: hibernate://?dsname=MySF. 
				The first (protocol) part of this
				URL should be <em>hibernate</em>. The rest of the URL in this example 
				consists of one parameter, nl. dsname. 
				The dsname parameter (or better the constant HibernateResource.DS_NAME_PARAM)
				should be set to the name of the SessionFactory 
				created through the HibernateHelper.INSTANCE.createRegisterSessionFactory call. See 
				<a href="tutorial1_2.html">step 2 of this tutorial.</a></p>
			<source>
String uriStr = "hibernate://?" + HibernateResource.DS_NAME_PARAM + "=MySF";
final URI uri = URI.createURI(uriStr);
ResourceSet resourceSet = new ResourceSetImpl();
final Resource res = resourceSet.createResource(uri);
	</source>		
		</section>
		<section>
			<title>Load the resource</title>
			<p>The resource can now be loaded. In this example we also get the contents and iterate throught them.</p>
			<source>
res.load(Collections.EMPTY_MAP);
Iterator it = res.getContents().iterator();
Library libTest;
while (it.hasNext())
{
	libTest = (Library)it.next();
	System.out.println(libTest.getName());
}
</source>
			<p><em>The above makes clear that only the Library objects are present as a top level object.</em>
				The other objects can always be reached from the library objects. 
				See <a href="../hibernateresources.html">here</a> for a discussion of this characteristic.</p>
		</section>
		<section>
			<title>Update and add</title>
			<p>Now a new library, writer and book are added to the library example.</p>
			<source>
Library libNew = LibraryFactory.eINSTANCE.createLibrary();
libNew.setName("My Second Library");
	
// create a writer
Writer writerNew = LibraryFactory.eINSTANCE.createWriter();
writerNew.setName("I. Asimov");
   
// and one of his books
Book bookNew = LibraryFactory.eINSTANCE.createBook();
bookNew.setAuthor(writerNew);
bookNew.setPages(305);
bookNew.setTitle("Foundation and Empire");
bookNew.setCategory(BookCategory.SCIENCE_FICTION_LITERAL);

// add the writer/book to the library.
libNew.getWriters().add(writerNew);
libNew.getBooks().add(bookNew);
	
// now add the top-level object to the resource
res.getContents().add(libNew);
</source>
	<p>Because the new library object is added to the resource also its children (the book and writer) are added
	to the resource.</p>
		</section>
		<section>
			<title>Save the resource</title>
			<p>Now save the resource. Note that the resource handles things like transactions.</p>
			<source>
res.save(null);
			</source>
		</section>
	</body>
</document>